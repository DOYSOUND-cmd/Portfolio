/* =========================================================
   Product Detail 共通スタイル（iPhone 13/Safari 安定版）
   - ヒーロー
   - セクション
   - バッジ（アイコン付）
   - スクリーンショット（切り抜かずに全体表示）
   - PDF埋め込み
   - 3Dローダ/アスペクト比フォールバック
   ========================================================= */

/* ベース */
:root{
  --panel:#121826;
  --line:#1e2633;
  --text:#e6edf3;
  --muted:#9fb0c3;
  --brand:#6be7ff;
  --brand2:#9a7bff;

  --radius:14px;
  --shadow-1:0 10px 24px rgba(0,0,0,.24);
  --shadow-2:0 20px 48px rgba(0,0,0,.32);

  /* iOS Safari の動的ツールバー対策: dvh/svh が使えない場合のフォールバック */
  --vh-62: 62vh;
  --vh-58: 58vh;
  --vh-54: 54vh;
}

/* Safari のフォント自動拡大で改行がズレないように */
html { -webkit-text-size-adjust: 100%; }

/* ---------------- Hero ---------------- */
.pd-hero{
  background: linear-gradient(180deg,#ffffff08,#0000);
  border-bottom: 1px solid #ffffff12;
}
.pd-hero .container{
  padding-block: clamp(28px,5vw,48px);
}
.pd-hero__eyebrow{
  color: var(--muted);
  font-weight: 800;
  letter-spacing: .08em;
  text-transform: uppercase;
  margin-bottom: 6px;
}

/* グラデ文字は Safari で -webkit-text-fill-color が必要 */
.pd-hero__title{
  font-weight: 900;
  font-size: clamp(28px,4.5vw,44px);
  letter-spacing: .01em;
  margin: 0 0 10px;
  background: linear-gradient(90deg,var(--brand),var(--brand2));
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  color: transparent;
  line-height: 1.15; /* モバイルで詰まりすぎ防止 */
}
/* 見出しの強制改行（HTML側で <span class="mob-line"> を使う） */
.pd-hero__title .mob-line { display: inline; }
@media (max-width: 768px) {
  .pd-hero__title .mob-line { display: block; }
}

.pd-hero__lede{
  color: var(--text);
  opacity: .92;
  font-weight: 700;
  line-height: 1.7;
  margin: 0;
}

/* バッジ（アイコン付） */
.pd-badges{
  display: flex; flex-wrap: wrap; gap: 8px 10px;
  margin-top: 14px;
}
.pd-badges .badge{
  display: inline-flex; align-items: center; gap: 8px;
  padding: 8px 12px; border-radius: 999px;
  border: 1px solid var(--line);
  background: linear-gradient(180deg,#ffffff12,#ffffff06);
  color: var(--text); font-weight: 800; font-size: 14px;
  min-width: 0; /* Safari の flex はみ出し防止 */
}
.pd-badges--icons .badge__icon{
  width: 18px; height: 18px; object-fit: contain;
  border-radius: 4px; background: #0f141d;
}

/* CTA */
.pd-cta{ margin-top: 16px; }

/* ---------------- Section ---------------- */
.pd-section{ padding-block: clamp(28px,5vw,48px); }
.pd-section__title{
  font-weight: 900;
  font-size: clamp(20px,3.2vw,28px);
  margin: 0 0 16px;
}

/* ---------------- Screenshots ----------------
   画像を「必ず全体が見える」ようにする（切り抜かない）
------------------------------------------------ */
.pd-shots{
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px;
}
@media (min-width: 840px){
  .pd-shots{ grid-template-columns: 1fr 1fr; }
}

/* ★ 画像が1枚のとき左右中央に配置（.pd-shots--single を付ける） */
.pd-shots.pd-shots--single{
  grid-template-columns: 1fr;   /* 常に1列（大画面でも） */
  justify-items: center;        /* 横中央寄せ */
}
.pd-shots.pd-shots--single .pd-shot{
  max-width: min(900px, 100%);  /* 大きすぎ防止 */
  width: 100%;
}

.pd-shot{
  border: 1px solid var(--line);
  border-radius: var(--radius);
  background: #0f141d;
  box-shadow: var(--shadow-1);
  padding: 12px;
  display: flex;
  flex-direction: column;
  min-width: 0;
}

.pd-shot img{
  /* 切り抜かずに収める */
  width: 100%;
  height: auto;
  max-height: min(62svh, 720px); /* svh を優先 */
  object-fit: contain;           /* 画像の全体を見せる */
  background: #0b0f16;           /* 余白の背景 */
  border-radius: 8px;
  border: 1px solid #00000055;
}
/* svh がない環境（iOS 古めなど）へのフォールバック */
@supports not (height: 1svh) {
  .pd-shot img { max-height: min(var(--vh-62), 720px); }
}

.pd-shot figcaption{
  margin-top: 8px;
  color: var(--muted);
  font-weight: 700;
  font-size: 14px;
}

/* ---------------- Summary ---------------- */
.pd-summary p{
  margin: 0;
  color: var(--text);
  opacity: .95;
  line-height: 1.9;
  font-weight: 700;
}

/* ---------------- PDF ---------------- */
.pd-pdf{
  border: 1px solid var(--line);
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: var(--shadow-1);
  background: #0f141d;
}
.pd-pdf__frame{
  display: block;
  width: 100%;
  height: min(78svh, 900px);
  border: 0;
  background: #1b2230;
}
@supports not (height: 1svh) {
  .pd-pdf__frame { height: min(78vh, 900px); }
}

/* Links */
.pd-links{ display: flex; flex-wrap: wrap; gap: 10px; }
.pd-links--inline{ margin-top: 10px; }

/* ===== 3D Loader Overlay ===== */
.pd-3d__stage {
  position: relative;
}

/* aspect-ratio が不安定な Safari 対応のフォールバック用ボックス
   （デフォルト 16:9。必要に応じてブレークポイントで上書き） */
.pd-3d__stage::before{
  content: "";
  display: block;
  padding-top: 56.25%; /* 16:9 = 9/16*100 */
}
.pd-3d__canvas{
  position: absolute; inset: 0;
  width: 100%; height: 100%;
  display: block; /* iOS レイアウト崩れ防止 */
}
/* aspect-ratio が安定して使える環境では ::before を無効化 */
@supports (aspect-ratio: 16 / 9) {
  .pd-3d__stage { aspect-ratio: 16 / 9; }
  .pd-3d__stage::before{ content:none; display:none; padding:0; }
}

.pd-3d__loader {
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  gap: 10px;
  /* まずは確実な rgba フォールバック */
  background: rgba(0,0,0,.65);
  /* color-mix が使える環境では美しめに */
  background: color-mix(in srgb, black 65%, transparent);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
  transition: opacity .25s ease, visibility .25s ease;
  opacity: 1;
  visibility: visible;
  z-index: 3;
}
@supports not (background: color-mix(in srgb, black 65%, transparent)) {
  .pd-3d__loader { background: rgba(0,0,0,.65); }
}

.pd-3d__loader.is-done { opacity: 0; visibility: hidden; }

.pd-3d__spinner {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  border: 3px solid #ffffff33;
  border-top-color: #fff;
  animation: pdspin 0.9s linear infinite;
}
@keyframes pdspin { to { transform: rotate(360deg); } }

.pd-3d__label {
  color: var(--text, #e6edf3);
  font-weight: 800;
  letter-spacing: .02em;
}

/* ===== Strat 3D viewer: mobile portrait = taller aspect =====
   フォールバック（::beforeのpadding比率）と aspect-ratio の両対応で縦長変更 */
@media (max-width: 1024px) and (orientation: portrait) {
  /* フォールバック側（::before） */
  #scan-stage::before, #stl-stage::before { padding-top: 75%; } /* 4:3 */
  /* aspect-ratio 使えるならこちら */
  @supports (aspect-ratio: 4 / 3) {
    #scan-stage, #stl-stage { aspect-ratio: 4 / 3; }
  }
}
@media (max-width: 768px) and (orientation: portrait) {
  #scan-stage::before, #stl-stage::before { padding-top: 133.333%; } /* 3:4 */
  @supports (aspect-ratio: 3 / 4) {
    #scan-stage, #stl-stage { aspect-ratio: 3 / 4; }
  }
}
@media (max-width: 480px) and (orientation: portrait) {
  #scan-stage::before, #stl-stage::before { padding-top: 150%; } /* 2:3 */
  @supports (aspect-ratio: 2 / 3) {
    #scan-stage, #stl-stage { aspect-ratio: 2 / 3; }
  }
}

/* 念のため iOS 描画安定化 */
#scan-stage .pd-3d__canvas,
#stl-stage  .pd-3d__canvas {
  width: 100%;
  height: 100%;
  display: block;
}

/* モバイル時だけ h1 を任意の箇所で改行するためのユーティリティ（予備） */
.pd-hero__title .pd-mob-br { display: inline; }
@media (max-width: 600px) {
  .pd-hero__title .pd-mob-br { display: block; }
}
