/* =========================================================
   Product Detail ページ用スタイル（iPhone 13/Safari でも確認済み）
   - ヒーロー
   - セクション
   - バッジ（アイコン付き）
   - スクリーンショット（画像をしっかり見せる）
   - PDF埋め込み
   - 3Dビュー / アスペクト比フォールバック
   ========================================================= */

/* ベース */
:root{
  --panel:#ffffff;
  --line:#e3e6ea;
  --text:#161616;
  --muted:#5c6068;
  --brand:#cc0000;
  --brand2:#a60000;
  --page-bg:#f5f5f6;
  --radius:14px;
  --shadow-1:0 12px 30px rgba(0,0,0,.1);
  --shadow-2:0 20px 48px rgba(0,0,0,.14);

  /* iOS Safari の動的ツールバー対策: dvh/svh が使えない場合のフォールバック */
  --vh-62: 62vh;
  --vh-58: 58vh;
  --vh-54: 54vh;
}

/* Safari のフォント拡大で崩れないように */
html { -webkit-text-size-adjust: 100%; }

body{
  background: var(--page-bg);
  background-color: var(--page-bg);
  font-family: "Helvetica Neue","Noto Sans JP","Noto Sans",Arial,system-ui,-apple-system,"Segoe UI","Hiragino Sans","Roboto",sans-serif;
}


/* ---------------- Hero ---------------- */
.pd-hero{
  background: var(--page-bg);
}
.pd-hero .container{
  padding-block: clamp(28px,5vw,48px);
}
.pd-hero__eyebrow{
  color: var(--muted);
  font-weight: 800;
  letter-spacing: .08em;
  text-transform: uppercase;
  margin-bottom: 6px;
}

/* グラデ文字は Safari で -webkit-text-fill-color が必要 */
.pd-hero__title{
  font-weight: 900;
  font-size: clamp(28px,4.5vw,44px);
  letter-spacing: .01em;
  margin: 0 0 10px;
  background-image: linear-gradient(90deg,var(--brand),var(--brand2));
  color: var(--brand); /* background-clip が効かない環境向けの水色フォールバック */
  line-height: 1.15; /* 改行時に収まりやすいよう */
}
@supports (-webkit-background-clip:text){
  .pd-hero__title{
    -webkit-background-clip:text;
    background-clip:text;
    -webkit-text-fill-color: transparent;
    color: transparent;
  }
}
/* モバイル時の改行制御（HTMLで <span class="mob-line"> を挿入） */
.pd-hero__title .mob-line { display: inline; }
@media (max-width: 768px) {
  .pd-hero__title .mob-line { display: block; }
}

.pd-hero__lede{
  color: var(--text);
  opacity: .92;
  font-weight: 700;
  line-height: 1.7;
  margin: 0;
}

/* バッジ（アイコン付き） */
.pd-badges{
  display: flex; flex-wrap: wrap; gap: 8px 10px;
  margin-top: 14px;
}
.pd-badges .badge{
  display: inline-flex; align-items: center; gap: 8px;
  padding: 8px 12px; border-radius: 999px;
  border: 1px solid var(--line);
  background: linear-gradient(180deg,#ffffff,#f7f7f8);
  color: var(--text); font-weight: 800; font-size: 14px;
  min-width: 0; /* Safari の flex はみ出し防止 */
}
.pd-badges--icons .badge__icon{
  width: 18px; height: 18px; object-fit: contain;
  border-radius: 4px; background: #f2f4f7;
}

/* CTA */
.pd-cta{
  margin-top: 16px;
}
.pd-cta .btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:.4rem;
  padding:.85rem 1.6rem;
  border-radius:14px;
  border:1px solid var(--brand);
  background:var(--brand);
  color:#fff;
  font-weight:900;
  letter-spacing:.03em;
  text-transform:uppercase;
  box-shadow:0 18px 38px rgba(204,0,0,.24);
  transition:transform .25s ease, box-shadow .25s ease;
}
.pd-cta .btn:hover{
  transform:translateY(-2px);
  box-shadow:0 26px 48px rgba(204,0,0,.3);
  text-decoration:none;
}
.pd-cta .btn:active{ transform:translateY(0); }

/* ---------------- Section ---------------- */
.pd-section{
  padding-block: clamp(28px,5vw,48px);
}

.pd-section .container{
  position: static;
}
.pd-section__title{
  font-weight: 900;
  font-size: clamp(20px,3.2vw,28px);
  margin: 0 0 16px;
}

/* ---------------- Screenshots ----------------
   画像は「できるだけ大きく見せる」方針（無理な拡大はしない）
------------------------------------------------ */
.pd-shots{
  display: grid;
  grid-template-columns: 1fr;
  gap: 16px;
}
@media (min-width: 840px){
  .pd-shots{ grid-template-columns: 1fr 1fr; }
}

/* ※ 画像が1枚のときは中央寄せ（.pd-shots--single を付与） */
.pd-shots.pd-shots--single{
  grid-template-columns: 1fr;   /* 常に1列（単一枚なら） */
  justify-items: center;        /* 中央寄せ */
}
.pd-shots.pd-shots--single .pd-shot{
  max-width: min(900px, 100%);  /* 大きすぎを抑止 */
  width: 100%;
}

.pd-shot{
  border: 1px solid var(--line);
  border-radius: var(--radius);
  background: #f7f7f8;
  box-shadow: var(--shadow-1);
  padding: 12px;
  display: flex;
  flex-direction: column;
  min-width: 0;
}

.pd-shot__link{
  display:block;
  border-radius:8px;
  overflow:hidden;
  transform-origin:center;
  transition:transform .25s ease, box-shadow .25s ease;
}
.pd-shot__link:focus-visible{
  outline:2px solid color-mix(in oklab,var(--brand) 80%, #fff);
  outline-offset:4px;
}
.pd-shot__link:hover{
  transform:translateY(-2px);
}

.pd-shot img{
  /* 縦横比を崩さない */
  width: 100%;
  height: auto;
  max-height: min(62svh, 720px); /* svh が効く環境 */
  object-fit: contain;           /* 画像の全体を見せる */
  background: #f3f5f8;           /* 枠内の下地 */
  border-radius: 8px;
  border: 1px solid rgba(31,37,47,.12);
  transition:transform .3s ease;
}
@supports not (outline: 1px solid transparent) {
  .pd-shot__link:focus-visible{
    outline-color:var(--brand);
  }
}
.pd-shot__link:hover img,
.pd-shot__link:focus-visible img{
  transform:scale(1.02);
}

/* svh がない端末（iOS 旧端末など）へのフォールバック */
@supports not (height: 1svh) {
  .pd-shot img { max-height: min(var(--vh-62), 720px); }
}

.pd-shot figcaption{
  margin-top: 8px;
  color: var(--muted);
  font-weight: 700;
  font-size: 14px;
}

/* ---------------- Summary ---------------- */
.pd-summary p{
  margin: 0;
  color: var(--text);
  opacity: .95;
  line-height: 1.9;
  font-weight: 700;
}

/* ---------------- PDF ---------------- */
.pd-pdf{
  border: 1px solid var(--line);
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: var(--shadow-1);
  background: #f7f7f8;
}
.pd-pdf__frame{
  display: block;
  width: 100%;
  height: min(78svh, 900px);
  border: 0;
  background: #f2f4f7;
}
@supports not (height: 1svh) {
  .pd-pdf__frame { height: min(78vh, 900px); }
}

/* Links */
.pd-links{ display: flex; flex-wrap: wrap; gap: 10px; }
.pd-links--inline{ margin-top: 10px; }

/* ===== 3D Loader Overlay ===== */
.pd-3d__stage {
  position: relative;
}

/* aspect-ratio を無視する Safari 向けフォールバックボックス
   （デフォルト 16:9。必要に応じてブレークポイントで調整） */
.pd-3d__stage::before{
  content: "";
  display: block;
  padding-top: 56.25%; /* 16:9 = 9/16*100 */
}
.pd-3d__canvas{
  position: absolute; inset: 0;
  width: 100%; height: 100%;
  display: block; /* iOS ハイライトを無効 */
}
/* aspect-ratio が効く環境では ::before を無効化 */
@supports (aspect-ratio: 16 / 9) {
  .pd-3d__stage { aspect-ratio: 16 / 9; }
  .pd-3d__stage::before{ content:none; display:none; padding:0; }
}

.pd-3d__loader {
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  gap: 10px;
  /* まずは無難な rgba フォールバック */
  background: rgba(246,247,250,.9);
  /* color-mix が使える環境では少し薄くする */
  background: color-mix(in srgb, #f6f7fa 85%, transparent);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
  transition: opacity .25s ease, visibility .25s ease;
  opacity: 1;
  visibility: visible;
  z-index: 3;
}
@supports not (background: color-mix(in srgb, #f4f1eb 85%, transparent)) {
  .pd-3d__loader { background: rgba(244,241,235,.85); }
}

.pd-3d__loader.is-done { opacity: 0; visibility: hidden; }

.pd-3d__spinner {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  border: 3px solid rgba(31,37,47,.14);
  border-top-color: var(--brand);
  animation: pdspin 0.9s linear infinite;
}
@keyframes pdspin { to { transform: rotate(360deg); } }

.pd-3d__label {
  color: var(--text, #161616);
  font-weight: 800;
  letter-spacing: .02em;
}

/* ===== Strat 3D viewer: mobile portrait = taller aspect =====
   フォールバック（::before の padding ブロック）の aspect-ratio を縦長に変更 */
@media (max-width: 1024px) and (orientation: portrait) {
  /* フォールバック用（::before） */
  #scan-stage::before, #stl-stage::before { padding-top: 75%; } /* 4:3 */
  /* aspect-ratio が効かない端末用 */
  @supports (aspect-ratio: 4 / 3) {
    #scan-stage, #stl-stage { aspect-ratio: 4 / 3; }
  }
}
@media (max-width: 768px) and (orientation: portrait) {
  #scan-stage::before, #stl-stage::before { padding-top: 133.333%; } /* 3:4 */
  @supports (aspect-ratio: 3 / 4) {
    #scan-stage, #stl-stage { aspect-ratio: 3 / 4; }
  }
}
@media (max-width: 480px) and (orientation: portrait) {
  #scan-stage::before, #stl-stage::before { padding-top: 150%; } /* 2:3 */
  @supports (aspect-ratio: 2 / 3) {
    #scan-stage, #stl-stage { aspect-ratio: 2 / 3; }
  }
}

/* 端末差でキャンバスが切れないように念のため指定 */
#scan-stage .pd-3d__canvas,
#stl-stage  .pd-3d__canvas {
  width: 100%;
  height: 100%;
  display: block;
}

/* モバイル環境で h1 を行単位で折り返すためのユーティリティ（任意） */
.pd-hero__title .pd-mob-br { display: inline; }
@media (max-width: 600px) {
  .pd-hero__title .pd-mob-br { display: block; }
}
